---
- name: Download WordPress {{ wordpress_version }}
  ansible.builtin.unarchive:
    src: "{{ wp_mw_role_wordpress_download_url }}"
    dest: "{{ wp_mw_role_vhost_webroot }}"
    remote_src: true
    creates: "{{ wp_mw_role_vhost_webroot }}/wordpress/"

- name: Set ownership
  ansible.builtin.file:
    path: "{{ wp_mw_role_vhost_webroot }}"
    state: directory
    recurse: true
    owner: "{{ wp_mw_role_apache_user }}"
    group: "{{ wp_mw_role_apache_group }}"

- name: Search files in WordPress root path
  ansible.builtin.find:
    paths: "{{ wp_mw_role_vhost_webroot }}/wordpress/"
    file_type: file
  register: files

- name: Changes permissions to files in WordPress root path
  ansible.builtin.file:
    path: "{{ item.path }}"
    mode: "0640"
  loop: "{{ files.files }}"

- name: Search directories in WordPress root path
  ansible.builtin.find:
    paths: "{{ wp_mw_role_vhost_webroot }}/wordpress/"
    file_type: directory
  register: directories

- name: Changes permission to directories in WordPress root path
  ansible.builtin.file:
    path: "{{ item.path }}"
    mode: "0750"
  loop: "{{ directories.files }}"

- name: Set up wp-config
  ansible.builtin.template:
    src: "wp-config.php.j2"
    dest: "{{ wp_mw_role_vhost_webroot }}/wordpress/wp-config.php"
    mode: "0755"
